<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Recipes</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Tidymodels @ Bigelow</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Overview</a>
</li>
<li>
  <a href="RSample.html">RSample</a>
</li>
<li>
  <a href="Recipes.html">Recipes</a>
</li>
<li>
  <a href="Parsnip.html">Parsnip</a>
</li>
<li>
  <a href="Yardstick.html">Yardstick</a>
</li>
<li>
  <a href="Workflows.html">Workflows</a>
</li>
<li>
  <a href="Tune.html">Tune</a>
</li>
<li>
  <a href="WorkflowSets.html">Workflowsets</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="Iris.html">Ex. Iris</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Recipes</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#recipe-initiation">Recipe Initiation</a></li>
<li><a href="#roles">Roles</a></li>
<li><a href="#step-functions">Step Functions</a></li>
<li><a href="#prepping-the-recipe-and-baking-new-data">Prepping the Recipe and Baking New Data</a></li>
<li><a href="#further-resources">Further Resources</a></li>
</ul>
</div>

<p>Datasets usually must be preprocessed before use in modeling, either to meet model specifications and/or improve performance. The <a href="https://recipes.tidymodels.org/"><code>Recipes</code></a> package assembles pre-processing steps into objects so that transformations to one dataset can easily be applied to others.</p>
<p><br></p>
<div id="recipe-initiation" class="section level3">
<h3>Recipe Initiation</h3>
<p>Recipe objects are built by creating a “blank” recipe object and then adding on data transformations via functions.</p>
<p>To initiate a recipe object, we can pass a formula and template dataset to the <a href="https://recipes.tidymodels.org/reference/recipe.html"><code>recipe()</code></a> function. For this example, we start with the <code>data_split</code> testing/training split we defined in the <a href="RSample.html">RSample Tutorial</a>.</p>
<pre class="r"><code># Note that I could also use data_iris, head(data_iris), data_split, etc. as the template; what matters 
#   is that the names and types of the variables stay the same. For larger datasets, using head() 
#   is preferable. The exception to this rule is if you include transformations that require 
#   a comprehensive look at the dataset, such as step_corr().
template_data &lt;- training(data_split)

iris_recipe &lt;- recipe(Species ~ ., 
                      data = template_data)</code></pre>
<p><strong>Note:</strong> If you are building a recipe for a model with a specialized formula (eg. GAMs, which include smoothing functions), do not use it here. The formula should only represent outcomes and predictors, not any special operations/transformations (these will be incorporated within <code>Parsnip</code>).</p>
<p>Alternatively, we can define a recipe object by passing in a template dataset, a list of all variables to be included in a model, and a list of <em>roles</em> corresponding to variables (more on this below!). This is preferable for datasets with a high number of variables.</p>
<pre class="r"><code>iris_recipe2 &lt;- recipe (template_data, 
                        vars = c(&quot;Sepal.Length&quot;, &quot;Sepal.Width&quot;, 
                                 &quot;Petal.Length&quot;, &quot;Petal.Width&quot;, &quot;Species&quot;, &quot;row&quot;),
                        roles = c(&quot;predictor&quot;, &quot;predictor&quot;, 
                                 &quot;predictor&quot;, &quot;predictor&quot;, &quot;outcome&quot;, &quot;ID&quot;))</code></pre>
<p><br></p>
</div>
<div id="roles" class="section level3">
<h3>Roles</h3>
<p>When we create a recipe, each variable is assigned a <em>role</em>, either explicitly by the user or inferred from a formula. A variable can have any role, including outcome, predictor, ID, case weight, stratification variable, etc. The role of a variable determines its treatment by a recipe.</p>
<p>Usually, we only need outcome and predictor roles, which can be assigned automatically via a formula. We can view the roles assigned to variables by a recipe with <a href="https://recipes.tidymodels.org/reference/summary.recipe.html"><code>summary()</code></a>.</p>
<pre class="r"><code>iris_recipe |&gt; summary()</code></pre>
<pre><code>## # A tibble: 6 × 4
##   variable     type    role      source  
##   &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   
## 1 Sepal.Length numeric predictor original
## 2 Sepal.Width  numeric predictor original
## 3 Petal.Length numeric predictor original
## 4 Petal.Width  numeric predictor original
## 5 row          numeric predictor original
## 6 Species      nominal outcome   original</code></pre>
<pre class="r"><code># building a recipe that only processes one variable - Sepal.Length - and gives it a &quot;predictor&quot; role
recipe(~ Sepal.Length, data = template_data) |&gt; summary()</code></pre>
<pre><code>## # A tibble: 1 × 4
##   variable     type    role      source  
##   &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   
## 1 Sepal.Length numeric predictor original</code></pre>
<pre class="r"><code># building a recipe with two &quot;outcome&quot; variables
recipe(Species + Sepal.Length ~ ., data = template_data) |&gt; summary()</code></pre>
<pre><code>## # A tibble: 6 × 4
##   variable     type    role      source  
##   &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   
## 1 Sepal.Width  numeric predictor original
## 2 Petal.Length numeric predictor original
## 3 Petal.Width  numeric predictor original
## 4 row          numeric predictor original
## 5 Species      nominal outcome   original
## 6 Sepal.Length numeric outcome   original</code></pre>
<p>Once we’ve initiated a recipe, we can change the role for a variable using the <a href="https://recipes.tidymodels.org/reference/roles.html"><code>update_role()</code></a> function. In the case of <code>data_iris</code>, we would want to make <code>row</code> an ID variable so that it won’t be transformed as a predictor but will stay attached to the data for later processing.</p>
<ul>
<li>Note that <code>update_role()</code> is overriding the original formula / variable specifications passed to the recipe.</li>
</ul>
<pre class="r"><code># updating &#39;row&#39; to an ID variable
iris_recipe &lt;- iris_recipe |&gt;
  # note that we could pass multiple variable names in to change multiple roles at once 
  update_role(row, new_role = &quot;ID&quot;) 

# viewing the updated role
summary(iris_recipe)</code></pre>
<pre><code>## # A tibble: 6 × 4
##   variable     type    role      source  
##   &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   
## 1 Sepal.Length numeric predictor original
## 2 Sepal.Width  numeric predictor original
## 3 Petal.Length numeric predictor original
## 4 Petal.Width  numeric predictor original
## 5 row          numeric ID        original
## 6 Species      nominal outcome   original</code></pre>
<p>Once roles are assigned to variables, the <code>recipes</code> package includes several <a href="https://recipes.tidymodels.org/reference/has_role.html"><strong>selector functions</strong></a> to easily retrieve variables with specific types and/or roles. These functions are:</p>
<ul>
<li><code>has_role()</code></li>
<li><code>has_type()</code></li>
<li><code>all_predictors()</code></li>
<li><code>all_outcomes()</code></li>
<li><code>all_numeric_predictors()</code></li>
<li><code>all_nominal_predictors()</code></li>
<li><code>all_numeric()</code></li>
<li><code>all_nominal()</code></li>
</ul>
<p>Note that factor types are counted as nominal. Also note that some of these functions can only be used within <em>step functions</em>.</p>
<p><br></p>
</div>
<div id="step-functions" class="section level3">
<h3>Step Functions</h3>
<p>Step functions are used to specify the data transformations that we would like to include in a recipe. Each step function represents a unique data transformation and returns a recipe object with the transformation added.</p>
<p>Step functions take the following arguments:</p>
<ul>
<li><strong>A recipe object</strong></li>
<li><strong>A selector function</strong> or list of variables to which the step will be applied</li>
<li><strong>Any method-specific arguments</strong></li>
<li><strong>A skip argument</strong>: if <code>skip = TRUE</code>, then a step will only be applied to the template data, and not any further datasets. This is most useful for transformations to an outcome variable that is not guaranteed to exist in future datasets. Defaults to <code>skip = FALSE</code>.</li>
<li><strong><code>role</code></strong>: If a step creates new variables, this argument specifies their role. Optional.</li>
</ul>
<p>Some examples of step functions include:</p>
<ul>
<li><a href="https://recipes.tidymodels.org/reference/step_corr.html"><code>step_corr()</code></a> - remove highly correlated variables</li>
<li><a href="https://recipes.tidymodels.org/reference/step_log.html"><code>step_log()</code></a> - log transform data</li>
<li><a href="https://recipes.tidymodels.org/reference/step_interact.html"><code>step_interact()</code></a> - create interaction variables</li>
<li><a href="https://recipes.tidymodels.org/reference/step_center.html"><code>step_center()</code></a> - center variables to have a mean of 0</li>
<li><a href="https://recipes.tidymodels.org/reference/step_scale.html"><code>step_scale()</code></a> - scale variables to have a standard deviation of 1</li>
<li><a href="https://recipes.tidymodels.org/reference/step_zv.html"><code>step_zv()</code></a> / <a href="https://recipes.tidymodels.org/reference/step_nzv.html"><code>step_nzv()</code></a> - remove zero / near-zero variance predictors</li>
<li><a href="https://recipes.tidymodels.org/reference/step_naomit.html"><code>step_naomit()</code></a> - remove missing values</li>
<li><a href="https://recipes.tidymodels.org/reference/step_dummy.html"><code>step_dummy()</code></a> - convert nominal variables to <em>dummy/indicator</em> variables, which is useful when a model can only process numeric data. Note that some <code>parsnip</code> models, such as GAMs, will do this for you automatically.</li>
</ul>
<p>There are also several step functions that act as wrappers for common <code>dplyr</code> operations, including <a href="https://recipes.tidymodels.org/reference/step_filter.html"><code>step_filter()</code></a>, <a href="https://recipes.tidymodels.org/reference/step_rename.html"><code>step_rename()</code></a>, and <a href="https://recipes.tidymodels.org/reference/step_mutate.html"><code>step_mutate()</code></a>.</p>
<pre class="r"><code># adding some steps to our iris_recipe object
iris_recipe &lt;- iris_recipe |&gt;
  # removing highly correlated variables, which can often mess up models
  step_corr(all_numeric_predictors()) |&gt;
  # step_normalize() applies both step_center() and step_scale()
  step_normalize(all_numeric_predictors()) |&gt;
  # renaming the row variable - note use of role argument
  step_rename(Row = row, role = &quot;ID&quot;)

# calling the recipe prints its information - notice the steps listed
iris_recipe</code></pre>
<pre><code>## Recipe
## 
## Inputs:
## 
##       role #variables
##         ID          1
##    outcome          1
##  predictor          4
## 
## Operations:
## 
## Correlation filter on all_numeric_predictors()
## Centering and scaling for all_numeric_predictors()
## Variable renaming for Row</code></pre>
<p>Step functions can also cover much more complex operations. For a full list of step functions, see the official <a href="https://recipes.tidymodels.org/reference/index.html">Function Reference</a>.</p>
<p><strong>Note:</strong> Since step functions are applied successively to a recipe object, order matters. The <a href="https://recipes.tidymodels.org/articles/Ordering.html">Recipes Website</a> has some tips and tricks on handling step function order.</p>
<p><br></p>
</div>
<div id="prepping-the-recipe-and-baking-new-data" class="section level3">
<h3>Prepping the Recipe and Baking New Data</h3>
<p>Once we’ve added all the desired roles and steps to a recipe, use the <a href="https://recipes.tidymodels.org/reference/prep.html"><code>prep()</code></a> function to “train” the recipe on the template data – that is, use the template data to estimate the parameters/quantities required by steps.</p>
<ul>
<li>If we added or changed any roles from the original recipe creation, we can view that now. Use <a href="https://recipes.tidymodels.org/reference/formula.recipe.html"><code>formula()</code></a> to pull an updated formula from a prepped recipe object.</li>
</ul>
<pre class="r"><code># preparing the recipe using prep() 
iris_recipe_prepped &lt;- iris_recipe |&gt;
  prep()

# the steps are now trained for the template dataset
iris_recipe_prepped</code></pre>
<pre><code>## Recipe
## 
## Inputs:
## 
##       role #variables
##         ID          1
##    outcome          1
##  predictor          4
## 
## Training data contained 112 data points and no missing data.
## 
## Operations:
## 
## Correlation filter on Petal.Length [trained]
## Centering and scaling for Sepal.Length, Sepal.Width, Petal.Width [trained]
## Variable renaming for Row [trained]</code></pre>
<pre class="r"><code># We changed the role of Row in our recipe. See that in the updated formula
formula(iris_recipe_prepped)</code></pre>
<pre><code>## Species ~ Sepal.Length + Sepal.Width + Petal.Width
## &lt;environment: 0x116634158&gt;</code></pre>
<p>Finally, we can use the prepped recipe to process data. use <a href="https://recipes.tidymodels.org/reference/bake.html"><code>bake()</code></a> to process data.</p>
<p><strong>Note</strong>: <code>prep()</code> <strong>must</strong> be called before using a recipe to bake data - otherwise, the steps are not trained and the code will error.</p>
<pre class="r"><code># To extract the baked template data, pass in NULL as the new_data argument
prepped_training &lt;- bake(iris_recipe_prepped, 
                         new_data = NULL)
head(prepped_training)</code></pre>
<pre><code>## # A tibble: 6 × 5
##   Sepal.Length Sepal.Width Petal.Width   Row Species   
##          &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;int&gt; &lt;fct&gt;     
## 1      0.602        0.597        0.572    57 versicolor
## 2      0.114       -0.0716       0.439    62 versicolor
## 3      1.09         0.597        1.77    145 virginica 
## 4     -0.373       -1.19         0.172    90 versicolor
## 5     -0.00762     -0.517        1.64    115 virginica 
## 6     -1.23         0.151       -1.29     31 setosa</code></pre>
<pre class="r"><code># taking a glimpse at the original unprocessed testing set
head(testing(data_split))</code></pre>
<pre><code>##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species row
## 4           4.6         3.1          1.5         0.2  setosa   4
## 6           5.4         3.9          1.7         0.4  setosa   6
## 7           4.6         3.4          1.4         0.3  setosa   7
## 12          4.8         3.4          1.6         0.2  setosa  12
## 14          4.3         3.0          1.1         0.1  setosa  14
## 15          5.8         4.0          1.2         0.2  setosa  15</code></pre>
<pre class="r"><code># processing a new dataset by passing it as the new_data argument
prepped_testing &lt;- bake(iris_recipe_prepped, 
                        new_data = testing(data_split))

# the transformed final dataset
head(prepped_testing)</code></pre>
<pre><code>## # A tibble: 6 × 5
##   Sepal.Length Sepal.Width Petal.Width   Row Species
##          &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;int&gt; &lt;fct&gt;  
## 1     -1.47         0.151        -1.29     4 setosa 
## 2     -0.495        1.93         -1.03     6 setosa 
## 3     -1.47         0.820        -1.16     7 setosa 
## 4     -1.23         0.820        -1.29    12 setosa 
## 5     -1.84        -0.0716       -1.43    14 setosa 
## 6     -0.00762      2.16         -1.29    15 setosa</code></pre>
<p><br></p>
</div>
<div id="further-resources" class="section level3">
<h3>Further Resources</h3>
<ul>
<li><a href="https://www.tidymodels.org/start/recipes/" class="uri">https://www.tidymodels.org/start/recipes/</a>
<ul>
<li>A general walkthrough of the tidymodels process that pays special attention to the creation and application of recipes.</li>
</ul></li>
<li><a href="https://recipes.tidymodels.org/articles/Roles.html" class="uri">https://recipes.tidymodels.org/articles/Roles.html</a>
<ul>
<li>Further detail about roles in recipes</li>
</ul></li>
<li><a href="https://www.tmwr.org/recipes.html" class="uri">https://www.tmwr.org/recipes.html</a>
<ul>
<li>Goes into further details about good practices with preprocessing and the use of some key step functions, such as <code>step_interact()</code> and <code>step_dummy()</code>.</li>
</ul></li>
</ul>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
